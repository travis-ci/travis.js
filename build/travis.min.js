"use strict";var Travis,entity,key,name,_i,_j,_len,_len1,_ref,_ref1,_ref2,__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Travis=function(a){return new Travis.Session(a)},Travis.version="0.1.1",Travis.endpoints={org:"https://api.travis-ci.org",pro:"https://api.travis-ci.com"},Travis.endpoints["default"]=Travis.endpoints.org,Travis.callbacks={},Travis.globalCallbacks=[],Travis.callbacksFor=function(a){return Travis.globalCallbacks.concat(Travis.callbacks[a]||[])},Travis.notify=function(a,b){var c,d,e,f,g;for(f=Travis.callbacksFor(a),g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c({data:b,type:a}));return g},Travis.debug=function(){return Travis.on(function(a){return console.log(a.type,a.data)})},Travis.on=function(){var a,b,c,d,e,f,g;if(c=2<=arguments.length?__slice.call(arguments,0,d=arguments.length-1):(d=0,[]),a=arguments[d++],0===c.length)return Travis.globalCallbacks.push(a);for(g=[],e=0,f=c.length;f>e;e++)b=c[e],null==Travis.callbacks[b]&&(Travis.callbacks[b]=[]),g.push(Travis.callbacks[b].push(a));return g},Travis._setup=function(){var a,b,c;c=Travis.Entity;for(b in c)a=c[b],null!=a._setup&&a._setup();return Travis._setup=function(){}},"undefined"!=typeof module&&null!==module&&(module.exports=Travis),"undefined"!=typeof window&&null!==window&&(window.exports=Travis),this.Travis=Travis,Travis.Delegator={define:function(){var a,b,c,d;return c=3<=arguments.length?__slice.call(arguments,0,d=arguments.length-2):(d=0,[]),a=arguments[d++],b=arguments[d++],this.eachMethod.apply(this,__slice.call(c).concat([function(c){return function(d){return c.delegate(a,b,d)}}(this)]))},defineNested:function(){var a,b,c,d;return c=3<=arguments.length?__slice.call(arguments,0,d=arguments.length-2):(d=0,[]),a=arguments[d++],b=arguments[d++],this.eachMethod.apply(this,__slice.call(c).concat([function(c){return function(d){return c.delegateNested(a,b,d)}}(this)]))},defineSimple:function(){var a,b,c,d;return c=3<=arguments.length?__slice.call(arguments,0,d=arguments.length-2):(d=0,[]),a=arguments[d++],b=arguments[d++],this.eachMethod.apply(this,__slice.call(c).concat([function(c){return function(d){return c.delegateSimple(a,b,d)}}(this)]))},eachMethod:function(){var a,b,c,d,e,f,g,h;for(c=2<=arguments.length?__slice.call(arguments,0,e=arguments.length-1):(e=0,[]),a=arguments[e++],h=[],f=0,g=c.length;g>f;f++)b=c[f],h.push("string"==typeof b?a(b):b.delegationMethods?function(){var c,e,f,g;for(f=b.delegationMethods(),g=[],c=0,e=f.length;e>c;c++)d=f[c],g.push(a(d));return g}():null!=b.prototype?function(){var c;c=[];for(d in b.prototype)c.push(a(d));return c}():function(){var c;c=[];for(d in b)c.push(a(d));return c}());return h},delegate:function(a,b,c){return 0!==c.indexOf("_")?null!=b[c]?b[c]:b[c]=function(){var d,e,f,g;return d=2<=arguments.length?__slice.call(arguments,0,g=arguments.length-1):(g=0,[]),e=arguments[g++],"function"==typeof e?b[c].apply(this,d).then(e):(d.push(e),f=null!=b.then?b:b.call(a),new Travis.Promise(function(a){return f.then(function(b){var e;return e=b[c].apply(b,d),e.then(function(b){return a.succeed(b)}),e["catch"](function(b){return a.fail(b)})}),f["catch"](function(b){return a.fail(b)})}))}:void 0},delegateNested:function(a,b,c){return null!=b[c]?b[c]:b[c]=function(){var d;return d=1<=arguments.length?__slice.call(arguments,0):[],b.call(a,function(a){var b;return(b=a[c]).call.apply(b,[a].concat(__slice.call(d)))})}},delegateSimple:function(a,b,c){return null!=b[c]?b[c]:b[c]=b.call(a)[c]}},Travis.Entities={account:{index:["login",["type","id"]],one:["account"],many:["accounts"]},broadcast:{index:["id"],one:["broadcast"],many:["broadcasts"]},build:{index:["id",["repository_id","number"]],one:["build"],many:["builds"]},repository:{index:["id","slug"],one:["repo","repository"],many:["repos","repositories"]}},Travis.EntityMap={one:{},many:{}},_ref=Travis.Entities;for(name in _ref){for(entity=_ref[name],entity.name=name,_ref1=entity.one,_i=0,_len=_ref1.length;_len>_i;_i++)key=_ref1[_i],Travis.EntityMap.one[key]=entity;for(_ref2=entity.many,_j=0,_len1=_ref2.length;_len1>_j;_j++)key=_ref2[_j],Travis.EntityMap.many[key]=entity}Travis.Entity=function(){function a(a,b){this.session=a,this._store=b,this._setup()}return a._setup=function(){var a,b,c,d,e,f;if(b=function(a){return function(b){var c;return null!=(c=a.prototype)[b]?c[b]:c[b]=function(a){return this.attribute(b,a)}}}(this),null!=this.prototype.attributeNames)for(e=this.prototype.attributeNames,c=0,d=e.length;d>c;c++)a=e[c],b(a);if(null!=this.prototype.computedAttributes){f=[];for(a in this.prototype.computedAttributes)f.push(b(a));return f}},a.prototype.complete=function(a){return null==a&&(a=!0),null==this._fetch?!0:a&&null!=this.attributeNames&&this.hasAttributes()?!0:this._store().complete},a.prototype.hasAttributes=function(){var a,b,c,d,e,f,g,h;for(d=1<=arguments.length?__slice.call(arguments,0):[],0===d.length&&(d=this.attributeNames),b=this._store().data,e=0,f=d.length;f>e;e++)if(a=d[e],c=null!=(g=this.computedAttributes)&&null!=(h=g[a])?h.dependsOn:void 0){if(!this.hasAttributes.apply(this,c))return!1}else if(void 0===b[this.session._clientName(a)])return!1;return!0},a.prototype.attributes=function(){var a,b,c,d,e,f;if(b=2<=arguments.length?__slice.call(arguments,0,e=arguments.length-1):(e=0,[]),a=arguments[e++],"string"==typeof a&&(b.push(a),a=null),0===b.length&&(b=this.attributeNames,null!=this.computedAttributes)){f=this.computedAttributes;for(key in f)d=f[key],b.push(key)}return c=this.complete(!1)||this.hasAttributes.apply(this,b)?new Travis.Promise(function(a){return function(c){return c.succeed(a._attributes(b))}}(this)):this._fetch().wrap(function(a){return function(){return a._store().complete=!0,a._attributes(b)}}(this)),c.then(a)},a.prototype.attribute=function(a,b){return this.attributes(a).wrap(function(b){return b[a]}).then(b)},a.prototype.reload=function(){var a;return a=this._store(),a.cache={},a.data={},a.complete=!1,this},a.prototype._setup=function(){},a.prototype._attributes=function(a){var b,c,d,e,f,g,h,i;for(d=this._store().data,e={},c={},g=0,h=a.length;h>g;g++)name=a[g],(b=null!=(i=this.computedAttributes)?i[name]:void 0)?c[name]=b:e[name]=d[this.session._clientName(name)];for(key in c)f=c[key],e[key]=f.compute(d);return e},a.prototype._cache=function(){var a,b,c,d,e,f;return a=3<=arguments.length?__slice.call(arguments,0,f=arguments.length-2):(f=0,[]),d=arguments[f++],c=arguments[f++],b=this._store().cache,null==b[a]&&(b[a]={}),null!=(e=b[a])[d]?e[d]:e[d]=c.call(this)},a.prototype.then=function(a){return null!=a&&a(this),this},a.prototype.run=function(){return this},a.prototype["catch"]=function(){return this},a.prototype.onSuccess=function(){return this},a.prototype.onFailure=function(){return this},a.prototype.wrap=function(){var a,b,c,d;return a=2<=arguments.length?__slice.call(arguments,0,c=arguments.length-1):(c=0,[]),b=arguments[c++],(d=Travis.Promise.succeed(b(this))).expect.apply(d,a)},a}(),Travis.HTTP=function(){function a(a){var b,c;this.base=a.base,this.defaultHeaders=a.headers||{},null==(c=this.defaultHeaders)["User-Agent"]&&(c["User-Agent"]="travis.js/"+Travis.version+" "+Travis.System.info()),"undefined"!=typeof XMLHttpRequest&&null!==XMLHttpRequest?(b=a.xhrHeaders||["content-type","cache-control","expires","etag","last-modified"],this.rawRequest=function(a,c){var d,e,f;d=new XMLHttpRequest,d.open(a.method,a.url,!0),f=a.headers;for(name in f)e=f[name],"user-agent"!==name.toLowerCase()&&d.setRequestHeader(name,e);return d.onreadystatechange=function(){var a,e,f,g;if(4===d.readyState){for(e={},f=0,g=b.length;g>f;f++)a=b[f],e[a.toLowerCase()]=d.getResponseHeader(a);return c(d.status,e,d.responseText)}},d.send(a.body)}):(this.url=require("url"),this.adapters={"http:":require("http"),"https:":require("https")},this.rawRequest=function(a,b){var c,d,e,f,g;return e=this.url.parse(a.url),g="",c=this.adapters[e.protocol]||this.adapters["http:"],d={host:e.hostname,path:e.path,method:a.method,headers:a.headers},null!=e.port&&(d.port=e.port),f=c.request(d,function(a){return a.on("data",function(a){return g+=a}),a.on("end",function(){return b(a.statusCode,a.headers,g)})}),f.on("error",function(a){throw a}),null!=a.body&&f.write(a.body),f.end()})}return a.delegationMethods=function(){return["get","head","post","put","patch","delete","request"]},a.prototype.get=function(a,b,c){return this.request("GET",a,b,c)},a.prototype.head=function(a,b,c){return this.request("HEAD",a,b,c)},a.prototype.post=function(a,b,c){return this.request("POST",a,b,c)},a.prototype.put=function(a,b,c){return this.request("PUT",a,b,c)},a.prototype.patch=function(a,b,c){return this.request("PATCH",a,b,c)},a.prototype["delete"]=function(a,b,c){return this.request("DELETE",a,b,c)},a.prototype.request=function(a,b,c,d){var e,f;return d=this.prepareRequest(a,b,c,d),e=this,f=new Travis.Promise(function(b){var c,f;return c=function(b,c,d){var e;return e={status:b,headers:c,body:d},null!=d&&"HEAD"!==a&&/^application\/json/.test(c["content-type"])&&(e.body=JSON.parse(d)),Travis.notify("http:response",e),e},(f=function(d,g){var h;for(key in g)h=g[key],d[key]=h;return Travis.notify("http:request",d),e.rawRequest(d,function(e,g,h){switch(e){case 200:case 201:case 204:return b.succeed(c(e,g,h));case 301:case 302:case 303:return f(d,{url:g.location,method:"HEAD"===a?a:"GET"});case 307:case 308:return f(d,{url:g.location});default:return b.fail(c(e,g,h))}})})(d)}),"HEAD"!==a&&"GET"!==a&&f.run(),null!=d.callback&&f.then(d.callback),f},a.prototype.prepareRequest=function(a,b,c,d){var e,f;if(null==b)throw new Error("path is missing");"function"==typeof d&&(d={callback:d}),null==d&&(d={}),d.method=a,null==d.headers&&(d.headers={}),d.url=/^https?:/.test(b)?b:""+this.base+b,f=this.defaultHeaders;for(key in f)e=f[key],null==d.headers[key]&&(d.headers[key]=e);return"function"==typeof c&&(d.callback=c,c=null),null!=c&&this.setParams(d,c),d},a.prototype.setParams=function(a,b){return"HEAD"===a.method||"GET"===a.method?this.setQueryParams(a,b):this.setBody(a,b)},a.prototype.setBody=function(a,b){return"string"!=typeof b&&(a.headers["Content-Type"]="application/json",b=JSON.stringify(b)),a.body=b},a.prototype.setQueryParams=function(a,b){var c,d,e;if(c=a.url.indexOf("?")>=0?"&":"?","string"==typeof b)return a.url+=""+c+b;e=[];for(key in b)d=b[key],a.url+=""+c+encodeURIComponent(key)+"="+encodeURIComponent(d),e.push(c="&");return e},a}(),Travis.Promise=function(){function a(a){this._onSuccess=[],this._onFailure=[],this.data=null,this.closure=a,this.setState("sleeping")}return a.succeed=function(a){return(new Travis.Promise).succeed(a)},a.prototype.setState=function(a,b){return null!=b&&(this.data=b),this.sleeping="sleeping"===a,this.running="running"===a,this.failed="failed"===a,this.succeeded="succeeded"===a,this},a.prototype.run=function(){return this.sleeping&&(this.setState("running"),this.closure(this)),this},a.prototype.succeed=function(a){var b,c,d,e;for(this.setState("succeeded",a),Travis.notify("promise:succeed",a),e=this._onSuccess,c=0,d=e.length;d>c;c++)(b=e[c])(this.data);return this._onSuccess=[],this._onFailure=[],this},a.prototype.fail=function(a){var b,c,d,e;for(this.setState("failed",a),Travis.notify("promise:fail",a),e=this._onFailure,c=0,d=e.length;d>c;c++)(b=e[c])(this.data);return this._onSuccess=[],this._onFailure=[],this},a.prototype.onSuccess=function(a){return this.then(a,null,!1)},a.prototype.onFailure=function(a){return this.then(null,a,!1)},a.prototype.wrap=function(){var a,b,c,d,e,f;return b=2<=arguments.length?__slice.call(arguments,0,f=arguments.length-1):(f=0,[]),e=arguments[f++],d=this,c=new Travis.Promise(function(){return d.run()}),a=function(a){return e.length>1?e(a,c):c.succeed(e(a))},this.then(a,function(a){return c.fail(a)},!1),c.expect.apply(c,b)},a.prototype.iterate=function(){var a,b;return a=1<=arguments.length?__slice.call(arguments,0):[],this.each=function(a,b){var c;if(null==a)throw new Error("missing callback");return c=function(b){var c,d,e,f;for(f=[],d=0,e=b.length;e>d;d++)c=b[d],f.push(a(c));return f},this.then(c,b)},(b=Travis.Delegator).defineNested.apply(b,__slice.call(a).concat([this],[this.each])),this.iterate=function(){return this},this},a.prototype.expect=function(){var a,b;return a=1<=arguments.length?__slice.call(arguments,0):[],(b=Travis.Delegator).define.apply(b,__slice.call(a).concat([this],[this])),this},a.prototype.then=function(a,b,c){return null==c&&(c=null),null===c&&(c=null!=a||null!=b),null!=a&&void 0===b&&(b=function(a){throw a}),this.succeeded?null!=a&&a(this.data):this.failed?null!=b&&b(this.data):(null!=a&&this._onSuccess.push(a),null!=b&&this._onFailure.push(b),c&&this.run()),this},a.prototype["catch"]=function(a){return this.then(null,a),this},a}(),Travis.Session=function(){function a(a){var b;null==a&&(a={}),Travis._setup(),"string"==typeof a&&(a={url:Travis.endpoints[a]||a}),this._options=a,b={Accept:"application/vnd.travis-ci.2+json"},null!=a.token&&(b.Authorization="token "+a.token),this.http=new Travis.HTTP({headers:b,base:a.url||Travis.endpoints["default"]}),this.data={},Travis.Delegator.define(Travis.HTTP,this,this.github),Travis.Delegator.define(Travis.HTTP,this,this.github()),Travis.Delegator.defineSimple("each",this,this.accounts),Travis.Delegator.defineSimple("each",this,this.broadcasts),Travis.Delegator.defineSimple("each",this,this.repositories)}return a.prototype.account=function(a,b){return"string"==typeof a&&(a={login:a}),this.entity("account",a,b)},a.prototype.accounts=function(a,b){var c;return c=this.load("/accounts",a,b,function(a){return a.accounts}),c.iterate(Travis.Entity.account)},a.prototype.build=function(a,b){return"number"==typeof a&&(a={id:a}),this.entity("build",a,b)},a.prototype.broadcasts=function(a,b){var c;return c=this.load("/broadcasts",a,b,function(a){return a.broadcasts}),c.iterate(Travis.Entity.broadcast)},a.prototype.repository=function(a){return"string"==typeof a&&(a={slug:a}),"number"==typeof a&&(a={id:a}),this.entity("repository",a)},a.prototype.repositories=function(a,b){var c;return c=this.load("/repos",a,b,function(a){return a.repos}),c.iterate(Travis.Entity.repository)},a.prototype.load=function(a,b,c,d){var e;return null==d&&(d=function(a){return a}),"function"==typeof b&&(e=b,b={}),this.http.get(a,b).wrap(function(a){return function(b){return d(a.loadData(b.body))}}(this)).then(e).then(c)},a.prototype.loadData=function(a){var b,c,d,e,f,g,h;e={};for(c in a)if(f=a[c],d=Travis.EntityMap.one[c])(entity=this.entity(d,f))&&(e[c]=entity);else if(d=Travis.EntityMap.many[c])for(e[c]=[],g=0,h=f.length;h>g;g++)b=f[g],(entity=this.entity(d,b))&&e[c].push(entity);return e},a.prototype._entity=function(a,b,c){var d,e;return d=Travis.Entity[a.name]||Travis.Entity,e=function(d){return function(){return d._entityData(a,b,c)}}(this),new d(this,e)},a.prototype._entityData=function(a,b,c){var d,e,f;return d=null!=(e=this.data)[f=a.name]?e[f]:e[f]={},d=null!=d[b]?d[b]:d[b]={},null!=d[c]?d[c]:d[c]={data:{},complete:!1,cache:{}}},a.prototype._parseField=function(a,b){return/_at$/.test(a)&&null!=b?new Date(Date.parse(b)):b},a.prototype._readField=function(a,b){var c,d,e,f,g;if("string"==typeof b)return a[this._clientName(b)]||a[this._apiName(b)];for(c=[],f=0,g=b.length;g>f;f++){if(d=b[f],e=this._readField(a,d),void 0===e)return void 0;c.push(e)}return c},a.prototype._clientName=function(a){return a.replace(/_([a-z])/g,function(a){return a[1].toUpperCase()})},a.prototype._apiName=function(a){return a.replace(/[A-Z]/g,function(a){return"_"+a[0].toLowerCase()})},a.prototype.entity=function(a,b,c,d){var e,f,g,h,i,j,k,l;if(null==d&&(d=!1),"string"==typeof a&&(e=a,a=Travis.Entities[a],null==a))throw new Error("unknown entity type "+e);for(entity=null,l=a.index,j=0,k=l.length;k>j;j++)if(g=l[j],f=this._readField(b,g)){null==entity&&(entity=this._entity(a,g,f)),h=this._entityData(a,g,f),d&&(h.complete=!0);for(key in b)i=b[key],h.data[this._clientName(key)]=this._parseField(key,i)}return entity.then(c)},a.prototype.session=function(a){var b,c;c=this._options;for(key in c)b=c[key],null==a[key]&&(a[key]=b);return new Travis.Session(a)},a.prototype.config=function(a){var b;return null==(b=this.config).promise&&(b.promise=this.http.get("/config").wrap(function(a){return a.body.config})),this.config.promise.then(a)},a.prototype.github=function(a){var b;return null==(b=this.github).promise&&(b.promise=this.config().wrap(function(a){return new Travis.HTTP({base:a.github.api_url})})),this.github.promise.then(a)},a.prototype.authenticate=function(a,b){var c;return"string"==typeof a&&(a={token:a}),null!=a.token?(c=new Travis.Promise,c.succeed(this.session({token:a.token}))):null!=a.githubToken?c=this.http.post("/auth/github",{github_token:a.githubToken}).wrap(function(a){return function(b){return a.session({token:b.body.access_token})}}(this)):null!=a.githubUser&&null!=a.githubPassword?c.fail(new Error("github password auth not yet supported")):c=new Travis.Promise(function(a){return a.fail(new Error("token or githubToken required"))}),c.then(b)},a.prototype.clearCache=function(){return this.data={},this},a}(),Travis.System={info:function(){return null!=("undefined"!=typeof navigator&&null!==navigator?navigator.userAgent:void 0)?navigator.userAgent:"undefined"!=typeof process&&null!==process?"node/"+process.versions.node+" ("+process.platform+") v8/"+process.versions.v8:"unknown"},base64:function(a){return"undefined"!=typeof Buffer&&null!==Buffer?new Buffer(a).toString("base64"):btoa(a)}},Travis.Entity.account=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.attributeNames=["id","name","login","type","reposCount","subscribed"],b.prototype._fetch=function(){return this.session.accounts({all:!0})},b}(Travis.Entity),Travis.Entity.broadcast=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.attributeNames=["id","message"],b.prototype._fetch=function(){return this.session.broadcasts()},b}(Travis.Entity),Travis.Entity.build=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.attributeNames=["id","repositoryId","commitId","number","pullRequest","pullRequestNumber","pullRequestTitle","config","state","startedAt","finishedAt","duration","jobIds"],b.prototype.computedAttributes={push:{dependsOn:["pullRequest"],compute:function(a){return!a.pullRequest}}},b.prototype.restart=function(a){return this._action("restart",a)},b.prototype.cancel=function(a){return this._action("cancel",a)},b.prototype._action=function(a,b){var c;return c=new Travis.Promise(function(b){return function(c){return b.id(function(d){return b.session.http.post("/builds/"+d+"/"+a,function(){return c.succeed(b.reload())})})}}(this)),c.run().then(b)},b.prototype._fetch=function(){var a;return a=this._store().data,a.id?this.session.load("/builds/"+a.id):this.session.load("/repos/"+a.repositoryId+"/builds",{number:a.number})},b}(Travis.Entity),Travis.Entity.repository=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.attributeNames=["id","slug","description","lastBuildId","lastBuildNumber","lastBuildState","lastBuildDuration","lastBuildStartedAt","lastBuildFinishedAt","githubLanguage"],b.prototype.computedAttributes={ownerName:{dependsOn:["slug"],compute:function(a){return a.slug.split("/",1)[0]}},name:{dependsOn:["slug"],compute:function(a){return a.slug.split("/",2)[1]}}},b.prototype.lastBuild=function(a){var b;return b=this._cache("build","last",function(a){return function(){return a.attributes().wrap(Travis.Entity.build,function(b,c){var d;return d=a.build({id:b.lastBuildId,number:b.lastBuildNumber,state:b.lastBuildState,duration:b.lastBuildDuration,startedAt:b.lastBuildStartedAt,finishedAt:b.lastBuildFinishedAt,repositoryId:b.id}),d.then(function(a){return c.succeed(a)})})}}(this)),b.then(a)},b.prototype.build=function(a,b){var c;return"number"==typeof a&&(a={number:a.toString()}),"string"==typeof a&&(a={number:optsion}),c=a.id?Travis.Promise.succeed(this.session.build(a)):this._cache("build","number",a.number,function(b){return function(){return b.attributes("repositoryId").wrap(function(c){return a.repositoryId=c.repositoryId,b.session.build(a)})}}(this)),c.expect(Travis.Entity.build).then(b)},b.prototype.builds=function(a,b){var c;return c=this.session.load(this._url("/builds"),a,b,function(a){return a.builds}),c.iterate(Travis.Entity.build)},b.prototype._url=function(a){var b;return null==a&&(a=""),b=this._store().data,"/repos/"+(b.id||b.slug)+a},b.prototype._fetch=function(){return this.session.load(this._url())},b}(Travis.Entity);
//# sourceMappingURL=travis.min.js.map